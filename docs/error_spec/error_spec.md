# エラー仕様書

## エラーレベル定義

| レベル | 説明             | 対応方針             |
| ------ | ---------------- | -------------------- |
| ERROR  | システム影響あり | エラー監視、対応必要 |
| WARN   | 業務影響なし     | 監視して傾向分析     |
| INFO   | 情報提供         | ログ記録のみ         |

## エラーコード一覧

### 認証関連エラー (AUTH_XXX)

| コード   | HTTP | エラーレベル | システムメッセージ   | ユーザー表示メッセージ                                     | 処理内容                                  |
| -------- | ---- | ------------ | -------------------- | ---------------------------------------------------------- | ----------------------------------------- |
| AUTH_001 | 401  | WARN         | Invalid credentials  | メールアドレスまたはパスワードが正しくありません           | ・認証失敗をログ記録 <br/> ・回数カウント |
| AUTH_002 | 401  | INFO         | Token expired        | セッションの有効期限が切れました。再度ログインしてください | ・期限切れトークンを無効化                |
| AUTH_003 | 401  | ERROR        | Invalid token        | 認証エラーが発生しました。再度ログインしてください         | ・不正トークンをログに記録                |
| AUTH_004 | 409  | INFO         | Email already exists | このメールアドレスは既に登録されています                   | ・重複をログ記録                          |

### バリデーションエラー (VAL_XXX)

| コード  | HTTP | エラーレベル | システムメッセージ     | ユーザー表示メッセージ                                    | 処理内容               |
| ------- | ---- | ------------ | ---------------------- | --------------------------------------------------------- | ---------------------- |
| VAL_001 | 400  | INFO         | Invalid email format   | 正しいメールアドレスの形式で入力してください              | ・入力値をログ記録     |
| VAL_002 | 400  | INFO         | Password too weak      | パスワードは 8 文字以上で、英数字を含めて設定してください | ・要件を画面表示       |
| VAL_003 | 400  | INFO         | Required field missing | 必須項目を入力してください                                | ・未入力項目を画面表示 |
| VAL_004 | 400  | INFO         | Invalid date format    | 正しい日付形式で入力してください                          | ・日付形式を画面表示   |

### リソースエラー (RES_XXX)

| コード  | HTTP | エラーレベル | システムメッセージ | ユーザー表示メッセージ           | 処理内容           |
| ------- | ---- | ------------ | ------------------ | -------------------------------- | ------------------ |
| RES_001 | 404  | WARN         | Resource not found | 指定されたデータが見つかりません | ・アクセスログ記録 |

### サーバーエラー (SRV_XXX)

| コード  | HTTP | エラーレベル | システムメッセージ    | ユーザー表示メッセージ                                       | 処理内容         |
| ------- | ---- | ------------ | --------------------- | ------------------------------------------------------------ | ---------------- |
| SRV_001 | 500  | ERROR        | Internal server error | システムエラーが発生しました。時間をおいて再度お試しください | 例外をログに記録 |
| SRV_002 | 500  | ERROR        | Database error        | システムメンテナンス中です。しばらくお待ちください           |                  |

## エラー発生時の基本フロー

1. エラー検知

   - エラーの種類を特定
   - エラーレベルの判定

2. ログ記録

   - エラーコード
   - エラーメッセージ
   - スタックトレース（必要な場合）
   - ユーザー情報
   - 操作内容（リクエスト内容）

3. ユーザー対応

   - エラーメッセージの表示

4. 復旧処理
   - 必要に応じてリトライ
   - エラー状態からの回復処理
   - セッション等の後処理

## エラーメッセージ設計方針

1. ユーザー向けメッセージ

   - 平易な言葉を使用
   - 技術的な詳細は含めない

2. システムメッセージ
   - エラーの技術的な詳細を含める
   - エラーの追跡が可能な情報を含める
